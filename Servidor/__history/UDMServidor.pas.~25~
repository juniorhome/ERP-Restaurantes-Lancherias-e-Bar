unit UDMServidor;

interface

uses
  System.SysUtils, System.Classes, uDWDataModule, uRESTDWPoolerDB,
  uRESTDWDriverZEOS, uDWAbout, IniFiles, uRESTDWDriverFD, orm.conexao.ModelConexaoFactory,
  FireDAC.Comp.Client;

type
  TDMServidor = class(TServerMethodDataModule)
    RESTDWPoolerDB1: TRESTDWPoolerDB;
    RESTDWDriverZeos1: TRESTDWDriverZeos;
    RESTDWDriverFD1: TRESTDWDriverFD;
  private
    { Private declarations }
    FArqIni: TIniFile;
    FDriverZeos: TRESTDWDriverZeos;
    FDriverFD: TRESTDWDriverFD;
  public
    { Public declarations }
    procedure ConfiguraConexao;
  end;

var
  DMServidor: TDMServidor;

implementation

uses
  Vcl.Forms, ZConnection;

{%CLASSGROUP 'Vcl.Controls.TControl'}

{$R *.dfm}

{ TDMServidor }

procedure TDMServidor.ConfiguraConexao;
var sFramework: string;
begin
  {
    Método que configura a conexão do banco de dados. Se é Zeos,Firedac.
  }
  FArqIni := TIniFile.Create(ExtractFilePath(Application.ExeName)+'\Config.ini');
  try
    sFramework := FArqIni.ReadString('Banco', 'Framework', '');
    if sFramework = 'Zeos' then
    begin

      try
        RESTDWPoolerDB1.RESTDriver := RESTDWDriverZeos1;
        RESTDWDriverZeos1.Connection :=  TZConnection(TModelConexaoFactory.New.Conexao(1).Connection);
      finally
        FDriverZeos.Free;
      end;
    end
    else if sFramework = 'Firedac' then
         begin

           try
             RESTDWPoolerDB1.RESTDriver := RESTDWDriverFD1;
             RESTDWDriverFD1.Connection := TFDConnection(TModelConexaoFactory.New.Conexao(2).Connection);
           finally
             FDriverFD.Free;
           end;
         end;
  finally
    FArqIni.Free;
  end;
end;

end.
